{% extends 'dashboard_base.html' %}
{% load static %}

{% block content %}
<style>
  .applications {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.app-card {
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  display: flex;
  justify-content: space-between;
  padding: 20px;
}

.app-info {
  flex: 3;
}

.details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 20px;
  margin-top: 10px;
}

.apply-btn, .continue {
  background-color: #ff6b35;
  color: #fff;
  border: none;
  padding: 8px 18px;
  border-radius: 5px;
  cursor: pointer;
}

.continue {
  background: none;
  color: #1a73e8;
  text-decoration: underline;
}

.journey {
  flex: 1;
  text-align: left;
}

.journey ul {
  list-style: none;
  padding: 0;
}

.journey li {
  padding: 5px 0;
  position: relative;
}

.journey li.active {
  color: #00a86b;
  font-weight: bold;
}

</style>
<header class="topbar">
  <h2>All Application Form(s)</h2>
  <p>Welcome <span class="highlight">{{ application.name }}</span></p>
  <div class="top-icons">
    <button class="help-btn">?</button>
    <div class="profile" onclick="toggleDropdown()">
      <span>{{ initials }}</span>
      <div class="dropdown-menu" id="logout-dropdown">
        <a href="{% url 'logout' %}">Logout</a>
      </div>
    </div>
  </div>
</header>

<section class="applications">
  {% for school_app in school_applications %}
    {% for app in school_app.applications %}
    <div class="app-card">
      <div class="app-info">
        <h3>{{ school_app.title }} Application Form</h3>
        <div class="details">
          <p><strong>Application No.</strong><br>{{ app.application_number }}</p>
          <p><strong>Application Submitted On</strong><br>{{ app.created_at|date:"d M Y" }}</p>
          <p><strong>Course</strong><br>{{ app.course }}</p>
          <p><strong>Specialization</strong><br>{{ app.specialization }}</p>
          <p><strong>Application Fees</strong><br>₹1023.60</p>
        </div>
        <div class="action">
          {% if app.status == 'completed' %}
            <a href="{% url 'details' %}?app_id={{ app.id }}" class="apply-btn">Proceed to Enrollment</a>
          {% elif app.status == 'enrolled' %}
            <a href="{% url 'application_submitted' %}?app_id={{ app.id }}" class="apply-btn">View Enrollment</a>
            <a href="{% url 'preview_pdf' %}?app_id={{ app.id }}" class="apply-btn" style="background-color: #28a745;">Download PDF</a>
          {% else %}
            <a href="{% url 'details' %}?app_id={{ app.id }}" class="continue">Continue Application →</a>
          {% endif %}
        </div>
      </div>
      <div class="journey">
        <h4>Enrolment Journey</h4>
        <ul>
          <li class="{% if app.status == 'initiated' or app.status == 'completed' or app.status == 'enrolled' %}active{% endif %}">Application Initiated</li>
          <li class="{% if app.status == 'completed' or app.status == 'enrolled' %}active{% endif %}">Application Completed</li>
          <li class="{% if app.status == 'enrolled' %}active{% endif %}">Enrolled</li>
        </ul>
      </div>
    </div>
    {% empty %}
    <div class="app-card">
      <div class="app-info">
        <h3>{{ school_app.title }} Application Form</h3>
        <div class="details">
          <p><strong>Application No.</strong><br>-</p>
          <p><strong>Application Submitted On</strong><br>-</p>
          <p><strong>Course</strong><br>-</p>
          <p><strong>Specialization</strong><br>-</p>
          <p><strong>Application Fees</strong><br>₹1023.60</p>
        </div>
        <div class="action">
          {% if school_app.school_id == 'doctorate' %}
            <a href="{% url 'application_form' %}?school=School of Doctorate" class="apply-btn">Apply Now</a>
          {% else %}
            <a href="{% url 'application_form' %}?school={{ school_app.school.title }}" class="apply-btn">Apply Now</a>
          {% endif %}
        </div>
      </div>
      <div class="journey">
        <h4>Enrolment Journey</h4>
        <ul>
          <li>Application Initiated</li>
          <li>Application Completed</li>
          <li>Enrolled</li>
        </ul>
      </div>
    </div>
    {% endfor %}
  {% endfor %}
</section>
{% endblock %}

